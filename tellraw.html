<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	
	ga('create', 'UA-76519362-1', 'auto');
	ga('send', 'pageview');
</script>
<!-- Hotjar Tracking Code for http://commandfox.github.io/mc-tools/ -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:200722,hjsv:5};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<div id="cont">
  <a id="back-home" href="index.html" style="display:block;position:absolute;top:5px;left:5px;color:#0087FF;">Return to Home</a>
  <script>function pegasus(a,b){return b=new XMLHttpRequest,b.open("GET",a),a=[],b.onreadystatechange=b.then=function(c,d,e,f){if(c&&c.call&&(a=[,c,d]),4==b.readyState&&(e=a[0|b.status/200])){try{f=JSON.parse(b.responseText)}catch(g){f=null}e(f,b)}},b.send(),b};</script>
  <h1>
    Created by CommandFox
  </h1><h3>
    (CommandFox's in-game username is currently: <span id="uname"></span>)
    <script>pegasus("https://eu.mc-api.net/v3/name/eab51d674e3f49118351793750823468").then(function(data,xhr){document.getElementById("uname").innerHTML=data["name"];});</script>
  </h3>
  <p>
    Enter the tellraw text into the following box, color and formatting codes are allowed (using an & sign), for example <span style="color:#ECA517">&6Gold</span>.
  </p>

  <input type="text" id="text" class="text" placeholder="Text, with formatting codes."/>
  Selector: <input type="text" id="selector" class="text" style="width: 25%;" placeholder="Selector, e.g. @a, @p, CommandFox or @e[type=Zombie]"/>
  <input type="submit" id="sub" class="sub"/>
  
  <span id="yrcmd" style="display:none">Your Command</span><br/>
  <textarea id="res" readonly style="display:none;">
    
  </textarea>
</div>
<style>
div#cont {
  text-align: center;
  background: #fff;
  font-family: Arial, Helvetica, sans-serif;
  padding: 10px;
}
textarea#res {
  width: 80%;
  border: 2px inset;
  text-align: left;
  background: #f0f0f0;
  color: #5F5F5F;
  padding: 5px 15px;
  margin: 0 auto;
  outline: none;
  height: 100px;
}
input {
  background: #f0f0f0;
  color: #5F5F5F;
  border-radius: 5px;
  padding: 5px 15px;
  margin: 12px auto;
  display: block;
  outline: none;
}
input.sub {
  background: #555;
  color: #fff;
  border: none;
  padding: 10px 20px;
}
input.sub {
  cursor: pointer;
}
input.text {
  width: 50%;
}
</style>
<script>
function parse(string){
	var getText = function(text){
  	  var result = "";
  	  while(text[0] != "&" && text.length > 0){
      	//console.log(result);
      	result += text.substring(0,1);
      	text = text.substring(1);
      }
      return {text:result,rest:text};
     };
    if(!/\&/.test(string)){
    	return [string];
    } else{
  	var colors = {"&0":"black","&1":"dark_blue","&2":"dark_green","&3":"dark_aqua","&4":"dark_red","&5":"dark_purple","&6":"gold","&7":"gray","&8":"dark_gray","&9":"blue","&a":"green","&b":"aqua","&c":"red","&d":"purple","&e":"yellow","&f":"white"};
    var options = {"&l":"bold","&n":"underlined","&o":"italic","&k":"obfuscated","&m":"strikethrough"};
  	var result = [];
    var text = getText(string);
    var current = {color:"none"};
    var nextCurrent = {};
    console.log(text.text);
    result.push(text.text);
    string = text.rest;
    loop1: while(string.length > 0){    
    	nextCurrent.color = "none";
      current = nextCurrent;
      nextCurrent = {};
      loop2: while(string[0] == "&"){				
        if(typeof colors[string.substring(0,2)] === "string"){
          current.color = colors[string.substring(0,2)];
          string = string.substring(2);
        } else if(typeof options[string.substring(0,2)] === "string"){
        	current[options[string.substring(0,2)]] = true;
          nextCurrent[options[string.substring(0,2)]] = false;
          string = string.substring(2);
        } else if(string.substring(0,2) === "&r"){
        	string = string.substring(2);
          break;
        }
      }
      var text = getText(string);
      current.text = text.text;
      
      string = text.rest;
      result.push(current);
      console.log(current);
    }
    return result;
  }
}
  document.getElementById("sub").onclick = function(){
    var entered = document.getElementById("text").value;
    var select = document.getElementById("selector").value;
    var res = document.getElementById("res");
    res.style.display = "block";
    document.getElementById("yrcmd").style.display = "block";
    var intext = ('innerText' in res)? 'innerText' : 'textContent';
    
    res[intext] = "/tellraw " + select.replace(/\s/g, "") + JSON.stringify(parse(entered.replace(/\{|\}|\[|\]/g, "\$1")));
  }
</script>
